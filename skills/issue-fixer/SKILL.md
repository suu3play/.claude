---
name: issue-fixer
description: GitHub Issueの内容を分析して改修計画を自動作成するスキル。「issue XXを改修」「issueから改修して」「issue対応して」「issue番号XXを修正して」と依頼された時に使用。開発ワークフローに従ってブランチ作成から改修計画立案までを実行
---

# Issue Fixer - GitHub Issue自動改修スキル

このスキルは、GitHub Issueの内容を分析し、開発ワークフローに従った改修計画を自動的に作成します。

## 使用タイミング

以下のいずれかの表現でIssue対応を依頼された時に自動的に起動します：

- 「issue XXを改修」「issue XXを改修して」
- 「issueから改修して」「issueを改修」
- 「issue対応して」「issue対応」
- 「issue番号XXを修正して」「issueXXを修正」
- 「GitHub IssueのXXを対応して」

**重要**: Issue番号や「issue」「改修」「修正」「対応」などのキーワードが含まれる依頼は、このスキルで処理されます。

## 実行フロー

### ステップ1: 開発ワークフローの読み込み

1. `.claude/rules/development-workflow.md`を読み込む
2. 必要に応じて以下の関連ルール・テンプレートも読み込む:
   - `.claude/rules/code-quality-standards.md` - コード品質基準
   - `.claude/templates/pull-request-template.md` - PRテンプレート
   - `.claude/templates/code-quality-check-template.md` - 品質チェックテンプレート

### ステップ2: プロジェクトとIssue番号の特定

1. ユーザーの依頼内容からプロジェクト名とIssue番号を抽出
   - 明示的に指定されている場合: そのまま使用
   - 指定されていない場合: ユーザーに確認

2. プロジェクトディレクトリの確認
   - `[プロジェクトルート]/[プロジェクト名]`が存在するか確認
   - 存在しない場合: エラーを報告してユーザーに確認

### ステップ3: GitHub Issueの取得と分析

1. プロジェクトディレクトリに移動
   ```bash
   cd "[プロジェクトルート]/[プロジェクト名]"
   ```

2. GitHub Issueの内容を取得
   ```bash
   gh issue view [issue番号]
   ```

3. Issue内容を分析:
   - タイトルと説明を確認
   - 問題の種類を判定（バグ修正、機能追加、リファクタリングなど）
   - 影響範囲を推定
   - 必要なファイルやコンポーネントを特定

### ステップ4: ブランチの作成

1. 現在のブランチを確認
   ```bash
   git status
   ```

2. mainブランチに移動して最新を取得
   ```bash
   git checkout main
   git pull
   ```

3. Issue対応用のブランチを作成
   - ブランチ名: `feature/issue-[issue番号]`
   ```bash
   git checkout -b feature/issue-[issue番号]
   ```

### ステップ5: 改修計画の立案

1. Issue内容に基づいて実装要件を整理:
   - 実装すべき機能や修正内容
   - 影響を受けるファイル
   - 追加・修正が必要なテスト
   - ドキュメント更新の必要性

2. 開発ワークフローに基づいた作業計画を策定:
   - 実装手順の明確化
   - 各ステップの詳細説明
   - 品質チェック項目の確認

3. **TodoWriteツールを使用して作業計画を作成**:
   - 各実装ステップをタスクとして登録
   - 優先順位と依存関係を明確化
   - コード品質チェックのタスクも含める

### ステップ6: ユーザーへの改修計画確認

1. 作成した改修計画をユーザーに提示
2. 以下の情報を明確に伝える:
   - 作成したブランチ名
   - 実装する内容の概要
   - 予想される作業時間
   - Todoリストの内容

3. **ユーザーの承認を待つ**
   - 「問題なし」「作業開始」「続行」などの指示があれば次のステップへ
   - 修正依頼があれば計画を調整

### ステップ7: 実装の実行

1. 改修計画に従って実装を開始
2. 各タスクを進める際にTodoリストを更新
3. 実装完了後、**ユーザーに修正内容の確認を求める**

### ステップ8: 修正内容の確認フェーズ

**重要**: 実装完了後、自動でコミットせずユーザーの確認を待つ

1. **修正内容のサマリーを表示**
   ```
   ✅ 修正完了

   📝 変更ファイル:
   - lib/features/user/user_service.dart（15行追加、3行削除）
   - lib/models/user.dart（新規作成）
   - test/user_service_test.dart（20行追加）

   📊 品質チェック結果:
   - flutter analyze: 396 issues（修正前: 475）
   - エラー削減: 79件

   次のステップ:
   1. 変更内容を確認してください
   2. 問題なければ「コミット」または「続行」と指示してください
   3. 修正が必要な場合は具体的に指示してください
   ```

2. **ユーザーの指示を待つ**
   - 「問題なし」「続行」「コミット」 → ステップ9へ
   - 修正依頼 → 該当箇所を修正してステップ8に戻る
   - 中止 → 処理を終了

### ステップ9: 変更内容のコミット

**ユーザーから承認を得た後のみ実行**

1. **変更ファイルの確認**
   ```bash
   git status --short
   git diff --stat
   ```

2. **コミットメッセージの生成と表示**
   - Conventional Commits形式
   - Issue番号を含める
   - 変更内容のサマリー

3. **コミットを実行**
   ```bash
   git add .
   git commit -m "feat: 機能追加 #XX"
   ```

4. **コミット結果を報告**
   ```
   ✅ コミット完了

   コミットID: abc1234
   メッセージ: feat: ユーザープロフィール編集機能を追加 #42

   次のステップ:
   「PR作成」と指示するとプッシュとPR作成を実行します
   ```

5. **ユーザーの指示を待つ**
   - 「PR作成」「プッシュ」「続行」 → ステップ10へ
   - その他の作業 → スキル終了

### ステップ10: プッシュとPR作成

**ユーザーから指示を得た後のみ実行**

1. **リモートへプッシュ**
   ```bash
   git push -u origin feature/issue-XX
   ```

2. **PR作成**
   ```bash
   gh pr create --title "..." --body "..."
   ```

3. **完了報告**
   ```
   ✅ プルリクエスト作成完了

   PR番号: #15
   URL: https://github.com/user/repo/pull/15

   作業完了しました。
   ```

## 使用例

### 例1: プロジェクト名とIssue番号を明示

**ユーザー**: growth-diary の issue 8 を改修して

**スキルの動作**:
1. 開発ワークフローを読み込み
2. `[プロジェクトルート]/growth-diary` に移動
3. `gh issue view 8` で Issue内容を取得
4. `feature/issue-8` ブランチを作成
5. Issue内容を分析して改修計画を作成
6. TodoWriteで作業タスクを登録
7. **ユーザーに改修計画を提示して承認を待つ**

**ユーザー**: 問題なし

**スキルの動作（続き）**:
8. 改修計画に従って実装を実行
9. 実装完了後、**修正内容をユーザーに報告して確認を待つ**

**ユーザー**: コミット

**スキルの動作（続き）**:
10. 変更内容をコミット
11. **コミット完了を報告して次の指示を待つ**

**ユーザー**: PR作成

**スキルの動作（続き）**:
12. プッシュとPR作成を実行
13. 作業完了を報告

### 例2: Issue番号のみ指定（カレントディレクトリで実行）

**ユーザー**: issue 5 を対応して

**スキルの動作**:
1. カレントディレクトリがプロジェクトディレクトリか確認
2. プロジェクト名を自動判定（ディレクトリ名から）
3. 以降は例1と同じフローで実行

### 例3: 曖昧な指定

**ユーザー**: このissueを修正して

**スキルの動作**:
1. ユーザーにプロジェクト名とIssue番号を確認
2. 確認後、例1と同じフローで実行

## 開発ワークフローとの連携

このスキルは、`.claude/rules/development-workflow.md`に定義された以下のルールに従います:

### ブランチ命名規則
- Issue対応: `feature/issue-[issue番号]`
- 例: `feature/issue-1`, `feature/issue-123`

### 作業フロー（ユーザー確認を含む）
1. ✅ ブランチ作成（このスキルが実行）
2. ✅ Issue分析と改修計画立案（このスキルが実行）
3. ⏸️ **ユーザー確認①**: 改修計画の承認
4. ✅ 実装の実行（このスキルが実行）
5. ✅ コード品質チェック（このスキルが実行）
6. ⏸️ **ユーザー確認②**: 修正内容の確認
7. ✅ コミット（ユーザー承認後に実行）
8. ⏸️ **ユーザー確認③**: PR作成の指示
9. ✅ プッシュ（ユーザー指示後に実行）
10. ✅ プルリクエスト作成（ユーザー指示後に実行）

### TodoWriteの活用

作業計画は必ずTodoWriteツールで管理:
```markdown
- [ ] Issue内容の詳細確認
- [ ] 影響範囲の特定
- [ ] 実装ファイルの作成・修正
- [ ] テストコードの追加
- [ ] コード品質チェック実行
- [ ] コミット
- [ ] プッシュとPR作成
```

## エラーハンドリング

### プロジェクトディレクトリが存在しない

```
エラー: プロジェクト '[プロジェクト名]' が見つかりません。
プロジェクトルート配下に存在するプロジェクトを確認してください。
```

### GitHub Issueが存在しない

```
エラー: Issue #[issue番号] が見つかりません。
正しいIssue番号か確認してください。
```

### Gitリポジトリではない

```
エラー: 指定されたディレクトリはGitリポジトリではありません。
git init を実行するか、正しいプロジェクトディレクトリを指定してください。
```

### ブランチが既に存在する

```
警告: ブランチ 'feature/issue-[issue番号]' は既に存在します。
既存のブランチを使用しますか？それとも新しいブランチ名を指定しますか？
```

## 注意事項

1. **ユーザー確認を必ず実施**
   - 改修計画立案後、実装前に承認を得る
   - 実装完了後、コミット前に修正内容を確認してもらう
   - コミット完了後、PR作成前に指示を待つ
   - **自動で次のステップに進まない**ことが重要

2. **ユーザー指示のキーワード**
   - 改修計画承認: 「問題なし」「作業開始」「続行」「OK」
   - コミット実行: 「コミット」「続行」「問題なし」
   - PR作成: 「PR作成」「プッシュ」「続行」
   - 修正依頼: 具体的な修正内容を指示
   - 中止: 「中止」「キャンセル」「停止」

3. **開発ワークフローの遵守**
   - 必ず開発ワークフローを読み込んでから実行します
   - ブランチ命名規則など、プロジェクトのルールに従います

4. **TodoWriteの使用**
   - 作業計画は必ずTodoリストとして管理します
   - 進捗状況が可視化されます
   - 各確認フェーズでTodoを更新

5. **GitHub CLI (gh) が必要**
   - Issue取得に `gh` コマンドを使用します
   - 事前に `gh auth login` で認証を完了してください

6. **権限の確認**
   - リポジトリへのアクセス権限があることを確認してください
   - プライベートリポジトリの場合は適切な認証が必要です

7. **各フェーズでの停止**
   - 実装完了後は必ず停止してユーザー確認を待つ
   - コミット完了後も停止してユーザー指示を待つ
   - ユーザーが明示的に指示するまで次に進まない

## 関連スキル・コマンド

- `/issue [プロジェクト名] [issue番号]` - カスタムスラッシュコマンド版（手動実行）
- `/create-pr [プロジェクト名]` - プルリクエスト作成コマンド
- `/analyze-errors` - エラー分析コマンド

## スキルの改善提案

このスキルは以下の機能拡張が可能です:

1. **自動ファイル検出**: Issue内容から自動的に関連ファイルを検索
2. **類似Issue検索**: 過去の類似Issueから修正パターンを学習
3. **自動テスト生成**: Issue内容に基づいてテストケースを提案
4. **見積もり機能**: 過去のデータから作業時間を推定

これらの機能が必要な場合は、スキルを拡張してください。
